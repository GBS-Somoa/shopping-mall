<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<h1>상품 상세 조회</h1>
<form th:object="${product}">
    <div>
        <label for="name">상품명</label>
        <input type="text" id="name" th:field="*{name}"
               placeholder="" readonly>
    </div>
    <div>
        <label for="price">가격</label>
        <input type="number" id="price" th:field="*{price}"
               placeholder="" readonly>
    </div>
    <div>
        <label for="imageUrl">이미지</label>
        <input type="text" id="imageUrl" th:field="*{imageUrl}"
               placeholder="" readonly>
    </div>
    <div>
        <label for="rating">평점</label>
        <input type="text" id="rating" th:field="*{rating}"
               placeholder="" readonly>
    </div>
    <div>
        <label for="reviewCount">리뷰 수</label>
        <input type="text" id="reviewCount" th:field="*{reviewCount}"
               placeholder="" readonly>
    </div>
    <div>
        <label for="barcode">바코드</label>
        <input type="text" id="barcode" th:field="*{barcode}"
               placeholder="" readonly>
    </div>
    <td>
        <img th:if="*{imageUrl}"
             th:src="*{imageUrl}" alt="productImage"/>
    </td>
    <button type="button"
            class="buyButton"
            th:onclick="'buy(' + *{id} + ')'">구매하기</button>
    <a href="/products">상품 목록</a>
</form>

<script>
    const buy = (productId) => {
        const randomCount = Math.floor(Math.random() * 3) + 1;

        const orderData = {
            deliveryFee: 2500,
            recipientName: "김싸피",
            recipientContact: "010-1234-5678",
            deliveryAddress: "서울특별시 강남구 역삼대로 212 멀티캠퍼스",
            orderProducts: [
                {
                    productId: productId,
                    count: randomCount
                }
            ]
        };

        fetch('/api/orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(orderData),
        })
            .then(response => response.json())
            .then(orderId => {
                console.log('Success:', orderId);
                window.location.href = '/orders/completed/' + orderId;
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('결제 오류가 발생했습니다.');
            });
    }
</script>

</body>
</html>