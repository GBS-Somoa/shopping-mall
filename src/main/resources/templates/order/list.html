<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>주문 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>주문 내역 관리</h1>
    <table>
        <thead>
        <tr>
            <th>주문번호</th>
            <th>주문자</th>
            <th>결제상태</th>
            <th>배송상태</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="order : ${orders}">
            <td th:text="${order.id}">202403110075154</td>
            <td>
                <a th:href="'/orders/' + ${order.id}"
                   th:text="${order.recipientName}">
                </a>
            </td>
            <td>
                <div th:switch="${order.paymentStatus}">
                    <p th:case="${T(com.s001.shoppingmall.order.entity.PaymentStatus).COMPLETED}"
                       th:text="결제완료">status1</p>
                    <p th:case="${T(com.s001.shoppingmall.order.entity.PaymentStatus).REFUNDED}"
                       th:text="환불완료">status2</p>
                </div>
            </td>
            <td>
                <div th:switch="${order.deliveryStatus}">
                    <p th:case="${T(com.s001.shoppingmall.order.entity.DeliveryStatus).DELIVERY_IN_PROGRESS}"
                       th:text="배송중">status1</p>
                    <p th:case="${T(com.s001.shoppingmall.order.entity.DeliveryStatus).DELIVERY_COMPLETED}"
                       th:text="배송완료">status2</p>
                    <p th:case="${T(com.s001.shoppingmall.order.entity.DeliveryStatus).ORDER_CANCELED}"
                       th:text="주문취소">status3</p>
                    <p th:case="${T(com.s001.shoppingmall.order.entity.DeliveryStatus).ORDER_COMPLETED}"
                       th:text="주문완료">status4</p>
                </div>
            </td>
        </tr>
        </tbody>
    </table>


    <!-- Pagination -->
    <div class="d-flex justify-content-center"
         th:object="${orders.pageable}"
         th:with="pageLine = 10,
                  pageNumber = *{pageNumber},
                  pageSize = *{pageSize},
                  totalPages = ${orders.totalPages},
                  startPage = ${(pageNumber / pageLine) * pageLine + 1},
                  endPage = (${(totalPages == 0) ? 1 : (startPage + (pageLine - 1) < totalPages ? startPage + (pageLine - 1) : totalPages)})">
        <ul class="pagination">

            <li th:classappend="${startPage <= 1} ? 'disabled'" class="page-item">
                <button class="page-link" aria-label="Previous"
                        th:onclick="'paging(' + ${pageNumber - pageLine} + ')'">
                    <span>&laquo;</span>
                    <span class="sr-only">10 Previous</span>
                </button>
            </li>

            <li th:classappend="${!orders.hasPrevious()} ? 'disabled'" class="page-item">
                <button class="page-link" aria-label="Previous"
                        th:onclick="'paging(' + ${pageNumber - 1} + ')'">
                    <span aria-hidden="true">&lt;</span>
                    <span class="sr-only">Previous</span>
                </button>
            </li>

            <li th:each="page: ${#numbers.sequence(startPage, endPage)}" th:classappend="${page - 1 == pageNumber} ? 'active'" class="page-item">
                <button th:text="${page}" class="page-link"
                        th:onclick="'paging(' + ${page - 1} + ')'"></button>
            </li>

            <li th:classappend="${!orders.hasNext()} ? 'disabled'" class="page-item">
                <button class="page-link" aria-label="Next"
                        th:onclick="'paging(' + ${pageNumber + 1} + ')'">
                    <span aria-hidden="true">&gt;</span>
                    <span class="sr-only">Next</span>
                </button>
            </li>

            <li th:classappend="${endPage >= totalPages} ? 'disabled'" class="page-item">
                <button class="page-link" aria-label="Next"
                        th:onclick="'paging(' + ${pageNumber + pageLine >= totalPages ? totalPages - 1 : pageNumber + pageLine} + ')'">
                    <span>&raquo;</span>
                    <span class="sr-only">10 Next</span>
                </button>
            </li>
        </ul>
    </div>
    <a href="/home">홈으로</a>

    <script>
        const baseUrl = '/orders?';

        const paging = (pageNumber) => {
            const urlParams = getUrlParams();
            if (pageNumber === undefined || pageNumber === null) {
                pageNumber = 0;
            }
            urlParams.set("page", pageNumber);
            refreshUrl(urlParams);
        }

        const search = () => {
            const keyword = document.querySelector('#keyword').value;
            const urlParams = getUrlParams();
            setSearchParam(urlParams, 'keyword', keyword);
            setSearchParam(urlParams, 'page', 0);
            refreshUrl(urlParams);
        }

        function setSearchParam(urlParams, param, value) {
            if (param !== undefined) {
                urlParams.set(param, value);
            }
        }

        const getUrlParams = () => {
            const url = new URL(window.location.href);
            return url.searchParams;
        }

        const refreshUrl = (urlParams) => {
            location.href = baseUrl + urlParams.toString();
        }

        const urlParams = getUrlParams();
        document.querySelector('#keyword').value = urlParams.get('keyword');
    </script>
</body>
</html>
